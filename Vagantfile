# -*- mode: ruby -*-
# vi: set ft=ruby :


Vagrant.configure("2") do |config|


  config.vm.box = "ubuntu/xenial64"
  config.vm.box_check_update = true

  config.vm.provider "virtualbox" do |vb|
    vb.memory = "4096"
    vb.cpus = "2"
  end


  # DOCKER PARA O GITLAB
  config.vm.define "docker_gitlab" do |docker_gitlab|
    docker_gitlab.vm.hostname = "docker_gitlab"
    node.vm.network "public_network", ip: "192.168.0.101", bridge: "wlp2s0"

    docker_gitlab.vm.provision "shell", inline: <<-SHELL
      echo 'Acquire::ForceIPv4 "true";' > /etc/apt/apt.conf.d/99force-ipv4
      apt-get clean
      apt-get -o Acquire::ForceIPv4=true update
      apt-get remove docker docker-engine docker.io -y
      curl -fsSL get.docker.com -o get-docker.sh
      bash get-docker.sh
      sudo docker run --detach \
        --hostname gitlab.example.com \
        --publish 443:443 --publish 80:80 --publish 422:22 \
        --name gitlab \
        --restart always \
        --volume /srv/gitlab/config:/etc/gitlab \
        --volume /srv/gitlab/logs:/var/log/gitlab \
        --volume /srv/gitlab/data:/var/opt/gitlab \
        gitlab/gitlab-ce:latest
    SHELL
  end

end
